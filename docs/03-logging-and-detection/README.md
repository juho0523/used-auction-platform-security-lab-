# 03 â€” Logging and Detection Implementation

## 1. Purpose

This document describes the implementation of logging and detection improvements
identified during AS-01 (SQL Injection Attempt & Detection Gap Analysis).

The goal of this phase is to enhance SOC visibility by introducing
application-level security logging and centralized detection using Wazuh.

---

## 2. Scope and Design Decisions

### 2.1 Scope Definition

The implementation focuses exclusively on the authentication workflow.
Other application components were intentionally excluded to maintain a clear
and risk-driven detection scope.

### 2.2 Design Rationale

Authentication endpoints were selected because they represent
the earliest and most observable interaction between external users
and the application.

This approach aligns with SOC practices that prioritize early-stage threat signals.

---

## 3. Application-Level Security Logging

### 3.1 Logging Strategy

Security logging was implemented at the application layer,
specifically within the login action where authentication results are determined.

The objective was to generate SOC-relevant events without logging sensitive data.

### 3.2 Logged Event Types

| Event Type | Description |
|----------|-------------|
| AUTH_FAIL | Authentication failure |
| AUTH_SUCCESS | Authentication success |

### 3.3 Logged Fields

The following fields were included in each security log entry:

- Timestamp
- Source IP address
- Target endpoint
- Authentication result
- Failure category (generic)

Sensitive information such as passwords and session identifiers were intentionally excluded.

---

## 4. Implementation Details

### 4.1 Modified Component

- Component: `LoginAction`
- Layer: Application (Controller)

### 4.2 Code Changes Overview

This section documents the code changes introduced to generate
application-level security logs.

(Insert code snippet and explanation here)

---

## 5. Log Output Verification

### 5.1 Log Generation

After deploying the modified application, authentication failures
were intentionally triggered to verify log generation.

### 5.2 Sample Log Output

```log
AUTH_FAIL | ip=127.0.0.1 | endpoint=login | reason=INVALID_CREDENTIAL
```
Screenshots and raw log files are provided as evidence.

---

## 6. Wazuh Integration

### 6.1 Architecture Overview

To improve centralized visibility and enable rule-based detection,
Wazuh was introduced as the primary detection platform.

The integration architecture is composed of the following components:

- Application Server: Apache Tomcat (hosting the legacy Java web application)
- Log Source: Application-level security logs generated by the authentication logic
- Wazuh Agent: Installed on the application host to collect log data
- Wazuh Manager: Centralized analysis, correlation, and alert generation

The Wazuh Agent monitors application log files and forwards relevant events
to the Wazuh Manager for processing.

---

### 6.2 Log Ingestion

Application security logs generated by the login action are written
to the Tomcat application log file.

The Wazuh Agent was configured to monitor this log file and extract
authentication-related events for analysis.

Only log entries matching the defined authentication event format
were ingested to minimize noise and reduce false positives.

This approach allows Wazuh to focus on security-relevant events
rather than general application or operational logs.

---

## 7. Detection Rule Design

### 7.1 Detection Objective

The objective of the detection rule was to identify suspicious
authentication activity that may indicate early-stage attack behavior.

Rather than attempting to conclusively identify SQL Injection,
the rule focuses on detecting anomalous patterns
that warrant SOC analyst attention.

---

### 7.2 Detection Logic

The detection logic was based on the following conditions:

- Multiple authentication failures
- Originating from a single source IP address
- Occurring within a short time window

This pattern is commonly observed during reconnaissance,
credential guessing, or injection attempts
and represents a meaningful early-stage threat signal.

---

### 7.3 Rule Definition (Conceptual)

The following is a simplified conceptual representation of the detection rule:

- IF authentication failure events exceed a defined threshold
- AND originate from the same source IP
- WITHIN a defined time interval
- THEN generate a security alert

The actual rule implementation and configuration
are provided in the Wazuh configuration files
documented in this directory.

---

## 8. Detection Results

### 8.1 Alert Generation

After deploying the detection rule, repeated authentication failures
were intentionally triggered from a single source IP
to validate alert generation.

Once the defined conditions were met,
Wazuh successfully generated an alert
indicating suspicious authentication activity.

---

### 8.2 Detection Evidence

The following evidence was collected to demonstrate successful detection:

- Wazuh alert triggered by repeated authentication failures
- Corresponding application security log entries
- Source IP and timestamp correlation

Screenshots and raw log files are provided
to validate the detection behavior and alert accuracy.

---

## 9. Limitations and Considerations

While the implemented detection significantly improves SOC visibility,
several limitations remain:

- Authentication-based detection alone cannot conclusively confirm SQL Injection
- Legitimate user behavior (e.g., repeated password errors) may generate alerts
- Database-level visibility was not included in this implementation

These limitations are acceptable for early-stage detection
and can be addressed through additional correlation
or contextual enrichment in future iterations.

---

## 10. Outcome

The logging and detection improvements implemented in this phase
successfully addressed the detection gaps identified in AS-01.

From a SOC perspective, failed authentication attempts are no longer silent events,
but observable and actionable security signals.

This implementation demonstrates how detection-oriented logging
and centralized analysis can enhance incident awareness
even when attacks fail at the technical level.
